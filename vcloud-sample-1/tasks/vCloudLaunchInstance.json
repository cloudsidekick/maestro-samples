{
    "Code": "071",
    "Codeblocks": [
        {
            "Name": "MAIN",
            "Steps": [
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Get deployment data values",
                    "FunctionName": "get_deployment_value",
                    "FunctionXML": "<function extension=\"maestro.datastore\" name=\"get_deployment_value\">\n\t\t\t\t\t<scope dataset=\"Deployment|Service\" datasource=\"local\" input_type=\"dropdown\" label=\"Scope\">Service</scope>\n\t\t\t\t\t<pairs is_array=\"true\" label=\"Key Value Pairs\">\n\t\t\t\t\t\t<pair label=\"Pair\">\n\t\t\t\t\t\t\t<key input_type=\"text\" label=\"Key\">vapptemplatename</key>\n\t\t\t\t\t\t\t<variable_name input_type=\"text\" label=\"Variable\" required=\"true\">vapptemplatename</variable_name>\n\t\t\t\t\t\t</pair>\n\t\t\t\t\t<pair label=\"Pair\">\n\t\t\t\t\t\t\t<key input_type=\"text\" label=\"Key\">sharedcred</key>\n\t\t\t\t\t\t\t<variable_name input_type=\"text\" label=\"Variable\" required=\"true\">sharedcred</variable_name>\n\t\t\t\t\t\t</pair></pairs>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 1,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "",
                    "FunctionName": "get_deployment_value",
                    "FunctionXML": "<function extension=\"maestro.datastore\" name=\"get_deployment_value\">\n\t\t\t\t\t<scope dataset=\"Deployment|Service\" datasource=\"local\" input_type=\"dropdown\" label=\"Scope\">Deployment</scope>\n\t\t\t\t\t<pairs is_array=\"true\" label=\"Key Value Pairs\">\n\t\t\t\t\t\t<pair label=\"Pair\">\n\t\t\t\t\t\t\t<key input_type=\"text\" label=\"Key\">datacenter</key>\n\t\t\t\t\t\t\t<variable_name input_type=\"text\" label=\"Variable\" required=\"true\">datacenter</variable_name>\n\t\t\t\t\t\t</pair>\n\t\t\t\t\t<pair label=\"Pair\">\n\t\t\t\t\t\t\t<key input_type=\"text\" label=\"Key\">netname</key>\n\t\t\t\t\t\t\t<variable_name input_type=\"text\" label=\"Variable\" required=\"true\">netname</variable_name>\n\t\t\t\t\t\t</pair></pairs>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 2,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Get admin user and password",
                    "FunctionName": "get_shared_cred",
                    "FunctionXML": "<function name=\"get_shared_cred\">\n\t\t\t\t\t<alias input_type=\"text\" label=\"Alias\" required=\"true\">[[sharedcred]]</alias>\n\t\t\t\t\t<userid input_type=\"text\" label=\"User ID Variable\">adminuser</userid>\n\t\t\t\t\t<password input_type=\"text\" label=\"Password Variable\">adminpass</password>\n\t\t\t\t\t<domain input_type=\"text\" label=\"Domain Variable\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 3,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "",
                    "FunctionName": "set_variable",
                    "FunctionXML": "<function name=\"set_variable\">\n\t\t\t\t\t<variables label=\"Variables\">\n\t\t\t\t\t\t<variable label=\"Variable\">\n\t\t\t\t\t\t\t<name input_type=\"text\" label=\"Name\">vappname</name>\n\t\t\t\t\t\t\t<value input_type=\"text\" label=\"Value\">[[_SERVICE_NAME]]-[[_UUID]]</value>\n\t\t\t\t\t\t\t<modifier input_type=\"select\" label=\"Modifier\">DEFAULT</modifier>\n\t\t\t\t\t\t</variable>\n\t\t\t\t\t</variables>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 4,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Get org href",
                    "FunctionName": "vcloud_call_parse",
                    "FunctionXML": "<function extension=\"vcloud.vcloud\" name=\"vcloud_call_parse\">\n\t\t\t\t\t<endpoint_name class=\"combo w300px\" dataset=\"ddDataSource_GetAllClouds\" datasource=\"function\" hr_after=\"true\" input_type=\"dropdown\" label=\"Cloud Endpoint Name\" />\n\t\t\t\t\t<path class=\"w90pct\" input_type=\"textarea\" label=\"Url or Method\" label_style=\"display: block;\" rows=\"1\">org</path>\n                    <method_or_href dataset=\"method|href\" datasource=\"local\" input_type=\"dropdown\" label=\"Method or Href\">method</method_or_href>\n                    <action dataset=\"GET|POST|DELETE|PUT\" datasource=\"local\" input_type=\"dropdown\" label=\"Action\">GET</action>\n\t\t\t\t\t<data class=\"w90pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\" />\n\t\t\t\t\t<content_type class=\"w90pct\" input_type=\"text\" label=\"Content Type\" />\n\t\t\t\t\t<xpath class=\"w90pct\" input_type=\"textarea\" label=\"Xpath\" label_style=\"display: block;\" rows=\"1\">Org</xpath>\n                    <values is_array=\"true\" label=\"Values to Extract\">\n                        <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">href</name>\n                            <variable input_type=\"text\" label=\"Variable\">org_href</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value>\n                    </values>\n\t\t\t\t\t<output_var input_type=\"text\" label=\"Output Variable\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 5,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Get datacenter href",
                    "FunctionName": "vcloud_call_parse",
                    "FunctionXML": "<function extension=\"vcloud.vcloud\" name=\"vcloud_call_parse\">\n\t\t\t\t\t<endpoint_name class=\"combo w300px\" dataset=\"ddDataSource_GetAllClouds\" datasource=\"function\" hr_after=\"true\" input_type=\"dropdown\" label=\"Cloud Endpoint Name\" />\n\t\t\t\t\t<path class=\"w90pct\" input_type=\"textarea\" label=\"Url or Method\" label_style=\"display: block;\" rows=\"1\">[[org_href]]</path>\n                    <method_or_href dataset=\"method|href\" datasource=\"local\" input_type=\"dropdown\" label=\"Method or Href\">href</method_or_href>\n                    <action dataset=\"GET|POST|DELETE|PUT\" datasource=\"local\" input_type=\"dropdown\" label=\"Action\">GET</action>\n\t\t\t\t\t<data class=\"w90pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\" />\n\t\t\t\t\t<content_type class=\"w90pct\" input_type=\"text\" label=\"Content Type\" />\n\t\t\t\t\t<xpath class=\"w90pct\" input_type=\"textarea\" label=\"Xpath\" label_style=\"display: block;\" rows=\"1\">Link/[@type=\"application/vnd.vmware.vcloud.vdc+xml\"]/.[@name=\"[[datacenter]]\"]</xpath>\n                    <values is_array=\"true\" label=\"Values to Extract\">\n                        <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">href</name>\n                            <variable input_type=\"text\" label=\"Variable\">vcd_href</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value>\n                    </values>\n\t\t\t\t\t<output_var input_type=\"text\" label=\"Output Variable\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 6,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Look up vapp template href",
                    "FunctionName": "vcloud_call_parse",
                    "FunctionXML": "<function extension=\"vcloud.vcloud\" name=\"vcloud_call_parse\">\n\t\t\t\t\t<endpoint_name class=\"combo w300px\" dataset=\"ddDataSource_GetAllClouds\" datasource=\"function\" hr_after=\"true\" input_type=\"dropdown\" label=\"Cloud Endpoint Name\" />\n\t\t\t\t\t<path class=\"w90pct\" input_type=\"textarea\" label=\"Url or Method\" label_style=\"display: block;\" rows=\"1\">/vAppTemplates/query?filter=name==[[vapptemplatename]]&amp;format=records</path>\n                    <method_or_href dataset=\"method|href\" datasource=\"local\" input_type=\"dropdown\" label=\"Method or Href\">method</method_or_href>\n                    <action dataset=\"GET|POST|DELETE|PUT\" datasource=\"local\" input_type=\"dropdown\" label=\"Action\">GET</action>\n\t\t\t\t\t<data class=\"w90pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\" />\n\t\t\t\t\t<content_type class=\"w90pct\" input_type=\"text\" label=\"Content Type\" />\n\t\t\t\t\t<xpath class=\"w90pct\" input_type=\"textarea\" label=\"Xpath\" label_style=\"display: block;\" rows=\"1\">VAppTemplateRecord</xpath>\n                    <values is_array=\"true\" label=\"Values to Extract\">\n                        <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">href</name>\n                            <variable input_type=\"text\" label=\"Variable\">base_vapp_href</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value>\n                    </values>\n\t\t\t\t\t<output_var input_type=\"text\" label=\"Output Variable\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 7,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Look up network href",
                    "FunctionName": "vcloud_call_parse",
                    "FunctionXML": "<function extension=\"vcloud.vcloud\" name=\"vcloud_call_parse\">\n\t\t\t\t\t<endpoint_name class=\"combo w300px\" dataset=\"ddDataSource_GetAllClouds\" datasource=\"function\" hr_after=\"true\" input_type=\"dropdown\" label=\"Cloud Endpoint Name\" />\n\t\t\t\t\t<path class=\"w90pct\" input_type=\"textarea\" label=\"Url or Method\" label_style=\"display: block;\" rows=\"1\">query?type=orgNetwork&amp;filter=name==[[netname]]&amp;format=records</path>\n                    <method_or_href dataset=\"method|href\" datasource=\"local\" input_type=\"dropdown\" label=\"Method or Href\">method</method_or_href>\n                    <action dataset=\"GET|POST|DELETE|PUT\" datasource=\"local\" input_type=\"dropdown\" label=\"Action\">GET</action>\n\t\t\t\t\t<data class=\"w90pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\" />\n\t\t\t\t\t<content_type class=\"w90pct\" input_type=\"text\" label=\"Content Type\" />\n\t\t\t\t\t<xpath class=\"w90pct\" input_type=\"textarea\" label=\"Xpath\" label_style=\"display: block;\" rows=\"1\">OrgNetworkRecord</xpath>\n                    <values is_array=\"true\" label=\"Values to Extract\">\n                        <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">href</name>\n                            <variable input_type=\"text\" label=\"Variable\">net_href</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value>\n                    </values>\n\t\t\t\t\t<output_var input_type=\"text\" label=\"Output Variable\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 8,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Get the virtual machine href and name from the vApp template",
                    "FunctionName": "vcloud_call_parse",
                    "FunctionXML": "<function extension=\"vcloud.vcloud\" name=\"vcloud_call_parse\">\n\t\t\t\t\t<endpoint_name class=\"combo w300px\" dataset=\"ddDataSource_GetAllClouds\" datasource=\"function\" hr_after=\"true\" input_type=\"dropdown\" label=\"Cloud Endpoint Name\" />\n\t\t\t\t\t<path class=\"w90pct\" input_type=\"textarea\" label=\"Url or Method\" label_style=\"display: block;\" rows=\"1\">[[base_vapp_href]]</path>\n                    <method_or_href dataset=\"method|href\" datasource=\"local\" input_type=\"dropdown\" label=\"Method or Href\">href</method_or_href>\n                    <action dataset=\"GET|POST|DELETE|PUT\" datasource=\"local\" input_type=\"dropdown\" label=\"Action\">GET</action>\n\t\t\t\t\t<data class=\"w90pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\" />\n\t\t\t\t\t<content_type class=\"w90pct\" input_type=\"text\" label=\"Content Type\" />\n\t\t\t\t\t<xpath class=\"w90pct\" input_type=\"textarea\" label=\"Xpath\" label_style=\"display: block;\" rows=\"1\">./Children/Vm</xpath>\n                    <values is_array=\"true\" label=\"Values to Extract\">\n                        <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">href</name>\n                            <variable input_type=\"text\" label=\"Variable\">vm_href</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value>\n                    <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">name</name>\n                            <variable input_type=\"text\" label=\"Variable\">vm_name</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value></values>\n\t\t\t\t\t<output_var input_type=\"text\" label=\"Output Variable\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 9,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Compose a new vApp",
                    "FunctionName": "vcloud_call_parse",
                    "FunctionXML": "<function extension=\"vcloud.vcloud\" name=\"vcloud_call_parse\">\n\t\t\t\t\t<endpoint_name class=\"combo w300px\" dataset=\"ddDataSource_GetAllClouds\" datasource=\"function\" hr_after=\"true\" input_type=\"dropdown\" label=\"Cloud Endpoint Name\" />\n\t\t\t\t\t<path class=\"w90pct\" input_type=\"textarea\" label=\"Url or Method\" label_style=\"display: block;\" rows=\"1\">[[vcd_href]]/action/composeVApp</path>\n                    <method_or_href dataset=\"method|href\" datasource=\"local\" input_type=\"dropdown\" label=\"Method or Href\">href</method_or_href>\n                    <action dataset=\"GET|POST|DELETE|PUT\" datasource=\"local\" input_type=\"dropdown\" label=\"Action\">POST</action>\n\t\t\t\t\t<data class=\"w90pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\">&lt;ComposeVAppParams\n   name=\"[[vappname]]\"\n   xmlns=\"http://www.vmware.com/vcloud/v1.5\"\n   xmlns:ovf=\"http://schemas.dmtf.org/ovf/envelope/1\"&gt;\n   &lt;Description&gt;test app&lt;/Description&gt;\n   &lt;InstantiationParams&gt;\n      &lt;NetworkConfigSection&gt;\n         &lt;ovf:Info&gt;Configuration parameters for logical networks&lt;/ovf:Info&gt;\n         &lt;NetworkConfig\n            networkName=\"[[netname]]\"&gt;\n            &lt;Configuration&gt;\n               &lt;ParentNetwork type=\"application/vnd.vmware.vcloud.orgVdcNetwork+xml\" name=\"[[netname]]\" href=\"[[net_href]]\"&gt;&lt;/ParentNetwork&gt;\n               &lt;FenceMode&gt;bridged&lt;/FenceMode&gt;\n            &lt;/Configuration&gt;\n         &lt;/NetworkConfig&gt;\n      &lt;/NetworkConfigSection&gt;\n   &lt;/InstantiationParams&gt;\n   &lt;AllEULAsAccepted&gt;true&lt;/AllEULAsAccepted&gt;\n&lt;/ComposeVAppParams&gt;</data>\n\t\t\t\t\t<content_type class=\"w90pct\" input_type=\"text\" label=\"Content Type\">application/vnd.vmware.vcloud.composeVAppParams+xml</content_type>\n\t\t\t\t\t<xpath class=\"w90pct\" input_type=\"textarea\" label=\"Xpath\" label_style=\"display: block;\" rows=\"1\">Tasks/Task</xpath>\n                    <values is_array=\"true\" label=\"Values to Extract\">\n                        <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">status</name>\n                            <variable input_type=\"text\" label=\"Variable\">status</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value>\n                    <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">href</name>\n                            <variable input_type=\"text\" label=\"Variable\">task_href</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value></values>\n\t\t\t\t\t<output_var input_type=\"text\" label=\"Output Variable\">x</output_var>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 10,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Extract new vapp href",
                    "FunctionName": "vcloud_parse",
                    "FunctionXML": "<function extension=\"vcloud.vcloud\" name=\"vcloud_parse\">\n\t\t\t\t\t<xml class=\"w90pct\" input_type=\"textarea\" label=\"XML Data\" label_style=\"display: block;\" rows=\"1\">[[x]]</xml>\n\t\t\t\t\t<path class=\"w90pct\" input_type=\"textarea\" label=\"Xpath\" label_style=\"display: block;\" rows=\"1\">.</path>\n                    <values is_array=\"true\" label=\"Values to Extract\">\n                        <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">href</name>\n                            <variable input_type=\"text\" label=\"Variable\">vapp_href</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value>\n                    </values>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 11,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Wait until task is completed",
                    "FunctionName": "while",
                    "FunctionXML": "<function name=\"while\" snip=\"test\">\n\t\t\t\t\t<test input_type=\"text\">\"[[status]]\" == \"running\"</test>\n\t\t\t\t\t<action><function name=\"codeblock\" snip=\"codeblock\">\n\t\t\t\t\t<codeblock input_type=\"text\">checktask</codeblock>\n\t\t\t\t</function></action>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 12,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": "\"[[status]]\" == \"running\"",
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Recompose new vApp, adding in the virtual machine",
                    "FunctionName": "vcloud_call_parse",
                    "FunctionXML": "<function extension=\"vcloud.vcloud\" name=\"vcloud_call_parse\">\n\t\t\t\t\t<endpoint_name class=\"combo w300px\" dataset=\"ddDataSource_GetAllClouds\" datasource=\"function\" hr_after=\"true\" input_type=\"dropdown\" label=\"Cloud Endpoint Name\" />\n\t\t\t\t\t<path class=\"w90pct\" input_type=\"textarea\" label=\"Url or Method\" label_style=\"display: block;\" rows=\"1\">[[vapp_href]]/action/recomposeVApp</path>\n                    <method_or_href dataset=\"method|href\" datasource=\"local\" input_type=\"dropdown\" label=\"Method or Href\">href</method_or_href>\n                    <action dataset=\"GET|POST|DELETE|PUT\" datasource=\"local\" input_type=\"dropdown\" label=\"Action\">POST</action>\n\t\t\t\t\t<data class=\"w90pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\">&lt;RecomposeVAppParams\n   xmlns=\"http://www.vmware.com/vcloud/v1.5\"\n   xmlns:ovf=\"http://schemas.dmtf.org/ovf/envelope/1\"&gt;\n &lt;InstantiationParams&gt;&lt;/InstantiationParams&gt;\n&lt;SourcedItem&gt;\n  &lt;Source href=\"[[vm_href]]\" name=\"[[vm_name]]\"&gt;&lt;/Source&gt;\n  &lt;/SourcedItem&gt;\n&lt;/RecomposeVAppParams&gt;</data>\n\t\t\t\t\t<content_type class=\"w90pct\" input_type=\"text\" label=\"Content Type\">application/vnd.vmware.vcloud.recomposeVAppParams+xml</content_type>\n\t\t\t\t\t<xpath class=\"w90pct\" input_type=\"textarea\" label=\"Xpath\" label_style=\"display: block;\" rows=\"1\">.</xpath>\n                    <values is_array=\"true\" label=\"Values to Extract\">\n                        <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">status</name>\n                            <variable input_type=\"text\" label=\"Variable\">status</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value>\n                    <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">href</name>\n                            <variable input_type=\"text\" label=\"Variable\">task_href</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value></values>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 13,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Wait until task is completed",
                    "FunctionName": "while",
                    "FunctionXML": "<function name=\"while\" snip=\"test\">\n\t\t\t\t\t<test input_type=\"text\">\"[[status]]\" == \"running\"</test>\n\t\t\t\t\t<action><function name=\"codeblock\" snip=\"codeblock\">\n\t\t\t\t\t<codeblock input_type=\"text\">checktask</codeblock>\n\t\t\t\t</function></action>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 14,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": "\"[[status]]\" == \"running\"",
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Get the virtual machine href from the new vApp",
                    "FunctionName": "vcloud_call_parse",
                    "FunctionXML": "<function extension=\"vcloud.vcloud\" name=\"vcloud_call_parse\">\n\t\t\t\t\t<endpoint_name class=\"combo w300px\" dataset=\"ddDataSource_GetAllClouds\" datasource=\"function\" hr_after=\"true\" input_type=\"dropdown\" label=\"Cloud Endpoint Name\" />\n\t\t\t\t\t<path class=\"w90pct\" input_type=\"textarea\" label=\"Url or Method\" label_style=\"display: block;\" rows=\"1\">[[vapp_href]]</path>\n                    <method_or_href dataset=\"method|href\" datasource=\"local\" input_type=\"dropdown\" label=\"Method or Href\">href</method_or_href>\n                    <action dataset=\"GET|POST|DELETE|PUT\" datasource=\"local\" input_type=\"dropdown\" label=\"Action\">GET</action>\n\t\t\t\t\t<data class=\"w90pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\" />\n\t\t\t\t\t<content_type class=\"w90pct\" input_type=\"text\" label=\"Content Type\" />\n\t\t\t\t\t<xpath class=\"w90pct\" input_type=\"textarea\" label=\"Xpath\" label_style=\"display: block;\" rows=\"1\">Children/Vm</xpath>\n                    <values is_array=\"true\" label=\"Values to Extract\">\n                        <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">name</name>\n                            <variable input_type=\"text\" label=\"Variable\">vm_name</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value>\n                    <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">href</name>\n                            <variable input_type=\"text\" label=\"Variable\">vm_href</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value></values>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 15,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Customize guest, set password",
                    "FunctionName": "vcloud_call_parse",
                    "FunctionXML": "<function extension=\"vcloud.vcloud\" name=\"vcloud_call_parse\">\n\t\t\t\t\t<endpoint_name class=\"combo w300px\" dataset=\"ddDataSource_GetAllClouds\" datasource=\"function\" hr_after=\"true\" input_type=\"dropdown\" label=\"Cloud Endpoint Name\" />\n\t\t\t\t\t<path class=\"w90pct\" input_type=\"textarea\" label=\"Url or Method\" label_style=\"display: block;\" rows=\"1\">[[vm_href]]/guestCustomizationSection/</path>\n                    <method_or_href dataset=\"method|href\" datasource=\"local\" input_type=\"dropdown\" label=\"Method or Href\">href</method_or_href>\n                    <action dataset=\"GET|POST|DELETE|PUT\" datasource=\"local\" input_type=\"dropdown\" label=\"Action\">PUT</action>\n\t\t\t\t\t<data class=\"w90pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;GuestCustomizationSection\n   xmlns=\"http://www.vmware.com/vcloud/v1.5\"\n   xmlns:ovf=\"http://schemas.dmtf.org/ovf/envelope/1\"\n   ovf:required=\"false\"&gt;\n   &lt;ovf:Info&gt;Specifies Guest OS Customization Settings&lt;/ovf:Info&gt;\n   &lt;Enabled&gt;true&lt;/Enabled&gt;\n   &lt;AdminPasswordEnabled&gt;true&lt;/AdminPasswordEnabled&gt;\n   &lt;AdminPasswordAuto&gt;false&lt;/AdminPasswordAuto&gt;\n   &lt;AdminPassword&gt;[[adminpass]]&lt;/AdminPassword&gt;\n&lt;CustomizationScript&gt;[[boot_script]]&lt;/CustomizationScript&gt;\n   &lt;ComputerName&gt;server&lt;/ComputerName&gt;\n&lt;/GuestCustomizationSection&gt;</data>\n\t\t\t\t\t<content_type class=\"w90pct\" input_type=\"text\" label=\"Content Type\">application/vnd.vmware.vcloud.guestcustomizationsection+xml</content_type>\n\t\t\t\t\t<xpath class=\"w90pct\" input_type=\"textarea\" label=\"Xpath\" label_style=\"display: block;\" rows=\"1\">.</xpath>\n                    <values is_array=\"true\" label=\"Values to Extract\">\n                        <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">href</name>\n                            <variable input_type=\"text\" label=\"Variable\">task_href</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value>\n                    <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">status</name>\n                            <variable input_type=\"text\" label=\"Variable\">status</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value></values>\n\t\t\t\t\t<output_var input_type=\"text\" label=\"Output Variable\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 16,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Wait until task is completed",
                    "FunctionName": "while",
                    "FunctionXML": "<function name=\"while\" snip=\"test\">\n\t\t\t\t\t<test input_type=\"text\">\"[[status]]\" == \"running\"</test>\n\t\t\t\t\t<action><function name=\"codeblock\" snip=\"codeblock\">\n\t\t\t\t\t<codeblock input_type=\"text\">checktask</codeblock>\n\t\t\t\t</function></action>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 17,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": "\"[[status]]\" == \"running\"",
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Setup network on vm",
                    "FunctionName": "vcloud_call_parse",
                    "FunctionXML": "<function extension=\"vcloud.vcloud\" name=\"vcloud_call_parse\">\n\t\t\t\t\t<endpoint_name class=\"combo w300px\" dataset=\"ddDataSource_GetAllClouds\" datasource=\"function\" hr_after=\"true\" input_type=\"dropdown\" label=\"Cloud Endpoint Name\" />\n\t\t\t\t\t<path class=\"w90pct\" input_type=\"textarea\" label=\"Url or Method\" label_style=\"display: block;\" rows=\"1\">[[vm_href]]/networkConnectionSection/</path>\n                    <method_or_href dataset=\"method|href\" datasource=\"local\" input_type=\"dropdown\" label=\"Method or Href\">href</method_or_href>\n                    <action dataset=\"GET|POST|DELETE|PUT\" datasource=\"local\" input_type=\"dropdown\" label=\"Action\">PUT</action>\n\t\t\t\t\t<data class=\"w90pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\">&lt;NetworkConnectionSection \n   type=\"application/vnd.vmware.vcloud.networkConnectionSection+xml\"\n   xmlns=\"http://www.vmware.com/vcloud/v1.5\"\n   xmlns:ovf=\"http://schemas.dmtf.org/ovf/envelope/1\"&gt;\n      &lt;ovf:Info &gt;&lt;/ovf:Info&gt;\n      &lt;PrimaryNetworkConnectionIndex&gt;0&lt;/PrimaryNetworkConnectionIndex&gt;\n      &lt;NetworkConnection network=\"[[netname]]\"&gt;\n        &lt;NetworkConnectionIndex&gt;0&lt;/NetworkConnectionIndex&gt;\n        &lt;IsConnected&gt;true&lt;/IsConnected&gt;\n        &lt;IpAddressAllocationMode&gt;POOL&lt;/IpAddressAllocationMode&gt;\n       &lt;/NetworkConnection&gt;\n     &lt;/NetworkConnectionSection&gt;</data>\n\t\t\t\t\t<content_type class=\"w90pct\" input_type=\"text\" label=\"Content Type\">application/vnd.vmware.vcloud.networkConnectionSection+xml</content_type>\n\t\t\t\t\t<xpath class=\"w90pct\" input_type=\"textarea\" label=\"Xpath\" label_style=\"display: block;\" rows=\"1\">.</xpath>\n                    <values is_array=\"true\" label=\"Values to Extract\">\n                        <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">href</name>\n                            <variable input_type=\"text\" label=\"Variable\">task_href</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value>\n                    <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">status</name>\n                            <variable input_type=\"text\" label=\"Variable\">status</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value></values>\n\t\t\t\t\t<output_var input_type=\"text\" label=\"Output Variable\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 18,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Wait until task is completed",
                    "FunctionName": "while",
                    "FunctionXML": "<function name=\"while\" snip=\"test\">\n\t\t\t\t\t<test input_type=\"text\">\"[[status]]\" == \"running\"</test>\n\t\t\t\t\t<action><function name=\"codeblock\" snip=\"codeblock\">\n\t\t\t\t\t<codeblock input_type=\"text\">checktask</codeblock>\n\t\t\t\t</function></action>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 19,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": "\"[[status]]\" == \"running\"",
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Power on virtual machine",
                    "FunctionName": "vcloud_call",
                    "FunctionXML": "<function extension=\"vcloud.vcloud\" name=\"vcloud_call\">\n\t\t\t\t\t<endpoint_name class=\"combo w300px\" dataset=\"ddDataSource_GetAllClouds\" datasource=\"function\" hr_after=\"true\" input_type=\"dropdown\" label=\"Cloud Endpoint Name\" />\n\t\t\t\t\t<path class=\"w90pct\" input_type=\"textarea\" label=\"Url or Method\" label_style=\"display: block;\" rows=\"1\">[[vm_href]]/power/action/powerOn</path>\n                    <method_or_href dataset=\"method|href\" datasource=\"local\" input_type=\"dropdown\" label=\"Method or Href\">href</method_or_href>\n                    <action dataset=\"GET|POST|DELETE|PUT\" datasource=\"local\" input_type=\"dropdown\" label=\"Action\">POST</action>\n\t\t\t\t\t<data class=\"w90pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\" />\n\t\t\t\t\t<content_type class=\"w90pct\" input_type=\"text\" label=\"Content Type\" />\n\t\t\t\t\t<output_var input_type=\"text\" label=\"Output Variable\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 20,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Get the ip address for this host",
                    "FunctionName": "vcloud_call_parse",
                    "FunctionXML": "<function extension=\"vcloud.vcloud\" name=\"vcloud_call_parse\">\n\t\t\t\t\t<endpoint_name class=\"combo w300px\" dataset=\"ddDataSource_GetAllClouds\" datasource=\"function\" hr_after=\"true\" input_type=\"dropdown\" label=\"Cloud Endpoint Name\" />\n\t\t\t\t\t<path class=\"w90pct\" input_type=\"textarea\" label=\"Url or Method\" label_style=\"display: block;\" rows=\"1\">[[vm_href]]/networkConnectionSection</path>\n                    <method_or_href dataset=\"method|href\" datasource=\"local\" input_type=\"dropdown\" label=\"Method or Href\">href</method_or_href>\n                    <action dataset=\"GET|POST|DELETE|PUT\" datasource=\"local\" input_type=\"dropdown\" label=\"Action\">GET</action>\n\t\t\t\t\t<data class=\"w90pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\" />\n\t\t\t\t\t<content_type class=\"w90pct\" input_type=\"text\" label=\"Content Type\" />\n\t\t\t\t\t<xpath class=\"w90pct\" input_type=\"textarea\" label=\"Xpath\" label_style=\"display: block;\" rows=\"1\">NetworkConnection</xpath>\n                    <values is_array=\"true\" label=\"Values to Extract\">\n                        <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">IpAddress</name>\n                            <variable input_type=\"text\" label=\"Variable\">address</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">element</type>\n                        </value>\n                    </values>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 21,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "Register vapp",
                    "FunctionName": "register_host_instance",
                    "FunctionXML": "<function extension=\"maestro.maestro\" name=\"register_host_instance\">\n\t\t\t\t\t<host_name input_type=\"text\" label=\"Hostname\">[[vappname]]</host_name>\n\t\t\t\t\t<address input_type=\"text\" label=\"Address\">[[address]]</address>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 22,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                }
            ]
        },
        {
            "Name": "checktask",
            "Steps": [
                {
                    "Codeblock": "checktask",
                    "Commented": false,
                    "Description": "Check task status",
                    "FunctionName": "vcloud_call_parse",
                    "FunctionXML": "<function extension=\"vcloud.vcloud\" name=\"vcloud_call_parse\">\n\t\t\t\t\t<endpoint_name class=\"combo w300px\" dataset=\"ddDataSource_GetAllClouds\" datasource=\"function\" hr_after=\"true\" input_type=\"dropdown\" label=\"Cloud Endpoint Name\" />\n\t\t\t\t\t<path class=\"w90pct\" input_type=\"textarea\" label=\"Url or Method\" label_style=\"display: block;\" rows=\"1\">[[task_href]]</path>\n                    <method_or_href dataset=\"method|href\" datasource=\"local\" input_type=\"dropdown\" label=\"Method or Href\">href</method_or_href>\n                    <action dataset=\"GET|POST|DELETE|PUT\" datasource=\"local\" input_type=\"dropdown\" label=\"Action\">GET</action>\n\t\t\t\t\t<data class=\"w90pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\" />\n\t\t\t\t\t<content_type class=\"w90pct\" input_type=\"text\" label=\"Content Type\" />\n\t\t\t\t\t<xpath class=\"w90pct\" input_type=\"textarea\" label=\"Xpath\" label_style=\"display: block;\" rows=\"1\">.</xpath>\n                    <values is_array=\"true\" label=\"Values to Extract\">\n                        <value label=\"Value\">\n                            <name input_type=\"text\" label=\"Attribute or Element Name\">status</name>\n                            <variable input_type=\"text\" label=\"Variable\">status</variable>\n                            <type dataset=\"attribute|element\" datasource=\"local\" input_type=\"dropdown\" label=\"Type\">attribute</type>\n                        </value>\n                    </values>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 1,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "checktask",
                    "Commented": false,
                    "Description": "sleep 5 second if task is still running",
                    "FunctionName": "if",
                    "FunctionXML": "<function name=\"if\">\n\t\t\t\t\t<tests>\n\t\t\t\t\t\t<test>\n\t\t\t\t\t\t\t<eval>\"[[status]]\" == \"running\"</eval>\n\t\t\t\t\t\t\t<action><function name=\"sleep\" snip=\"seconds\">\n\t\t\t\t\t<seconds input_type=\"text\" label=\"Sleep\">5</seconds>\n\t\t\t\t</function></action>\n\t\t\t\t\t\t</test>\n\t\t\t\t\t</tests>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 2,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                }
            ]
        }
    ],
    "ConcurrentInstances": "",
    "Description": "Launches a new vApp by composing a new vApp, adding a virtual machine and configuring and powering on. Will log into the vm using ssh, logout and terminate the vm.",
    "IsDefaultVersion": true,
    "MaxVersion": 1.0,
    "Name": "vCloud Launch Instance",
    "NextMajorVersion": "2.000",
    "NextMinorVersion": "1.001",
    "NumberOfApprovedVersions": 0,
    "Parameters": "<parameters />",
    "QueueDepth": "",
    "Status": "Development",
    "UseConnectorSystem": false,
    "Version": 1.0
}
