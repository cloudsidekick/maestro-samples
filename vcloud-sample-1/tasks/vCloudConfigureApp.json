{
    "Code": "073",
    "Codeblocks": [
        {
            "Name": "MAIN",
            "Steps": [
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "",
                    "FunctionName": "get_deployment_value",
                    "FunctionXML": "<function extension=\"maestro.datastore\" name=\"get_deployment_value\">\n\t\t\t\t\t<scope dataset=\"Deployment|Service\" datasource=\"local\" input_type=\"dropdown\" label=\"Scope\">Service</scope>\n\t\t\t\t\t<pairs is_array=\"true\" label=\"Key Value Pairs\">\n\t\t\t\t\t\t<pair label=\"Pair\">\n\t\t\t\t\t\t\t<key input_type=\"text\" label=\"Key\">sharedcred</key>\n\t\t\t\t\t\t\t<variable_name input_type=\"text\" label=\"Variable\" required=\"true\">cred</variable_name>\n\t\t\t\t\t\t</pair>\n\t\t\t\t\t</pairs>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 1,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "",
                    "FunctionName": "if",
                    "FunctionXML": "<function name=\"if\">\n\t\t\t\t\t<tests>\n\t\t\t\t\t\t<test>\n\t\t\t\t\t\t\t<eval>\"[[_SERVICE_NAME]]\" == \"Service A\"</eval>\n\t\t\t\t\t\t\t<action><function name=\"set_variable\">\n\t\t\t\t\t<variables label=\"Variables\">\n\t\t\t\t\t\t<variable label=\"Variable\">\n\t\t\t\t\t\t\t<name input_type=\"text\" label=\"Name\">gethosts</name>\n\t\t\t\t\t\t\t<value input_type=\"text\" label=\"Value\">Service B</value>\n\t\t\t\t\t\t\t<modifier input_type=\"select\" label=\"Modifier\">DEFAULT</modifier>\n\t\t\t\t\t\t</variable>\n\t\t\t\t\t</variables>\n\t\t\t\t</function></action>\n\t\t\t\t\t\t</test>\n\t\t\t\t\t<test><eval input_type=\"text\">\"[[_SERVICE_NAME]]\" == \"Service B\"</eval><action input_type=\"text\"><function name=\"set_variable\">\n\t\t\t\t\t<variables label=\"Variables\">\n\t\t\t\t\t\t<variable label=\"Variable\">\n\t\t\t\t\t\t\t<name input_type=\"text\" label=\"Name\">gethosts</name>\n\t\t\t\t\t\t\t<value input_type=\"text\" label=\"Value\">Service C</value>\n\t\t\t\t\t\t\t<modifier input_type=\"select\" label=\"Modifier\">DEFAULT</modifier>\n\t\t\t\t\t\t</variable>\n\t\t\t\t\t</variables>\n\t\t\t\t</function></action></test></tests>\n\t\t\t\t<else input_type=\"text\"><function name=\"set_variable\">\n\t\t\t\t\t<variables label=\"Variables\">\n\t\t\t\t\t\t<variable label=\"Variable\">\n\t\t\t\t\t\t\t<name input_type=\"text\" label=\"Name\">gethosts</name>\n\t\t\t\t\t\t\t<value input_type=\"text\" label=\"Value\">Service A</value>\n\t\t\t\t\t\t\t<modifier input_type=\"select\" label=\"Modifier\">DEFAULT</modifier>\n\t\t\t\t\t\t</variable>\n\t\t\t\t\t</variables>\n\t\t\t\t</function></else></function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 2,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "",
                    "FunctionName": "get_service_hosts",
                    "FunctionXML": "<function extension=\"maestro.maestro\" name=\"get_service_hosts\">\n\t\t\t\t\t<service_name input_type=\"text\" label=\"Service Name (input, optional)\">[[gethosts]]</service_name>\n\t\t\t\t\t<host_name_out input_type=\"text\" label=\"Host Name (output)\">hostname</host_name_out>\n\t\t\t\t\t<address_out input_type=\"text\" label=\"Host Address (output)\">hostaddress</address_out>\n\t\t\t\t\t<instance_name input_type=\"text\" label=\"Instance Name (output)\">instancename</instance_name>\n\t\t\t\t\t<instance_index input_type=\"text\" label=\"Instance Index (output)\">instanceindex</instance_index>\n\t\t\t\t\t<service_name_out input_type=\"text\" label=\"Service Name (output)\">servicename</service_name_out>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 3,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "",
                    "FunctionName": "get_shared_cred",
                    "FunctionXML": "<function name=\"get_shared_cred\">\n\t\t\t\t\t<alias input_type=\"text\" label=\"Alias\" required=\"true\">[[cred]]</alias>\n\t\t\t\t\t<userid input_type=\"text\" label=\"User ID Variable\">u</userid>\n\t\t\t\t\t<password input_type=\"text\" label=\"Password Variable\">p</password>\n\t\t\t\t\t<domain input_type=\"text\" label=\"Domain Variable\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 4,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "",
                    "FunctionName": "new_connection",
                    "FunctionXML": "<function name=\"new_connection\" snip=\"conn_name\">\n\t\t\t\t\t<conn_type input_type=\"select\">ssh</conn_type>\n\t\t\t\t\t<cloud_name input_type=\"dropdown\" style=\"combo\" />\n\t\t\t\t\t<asset input_type=\"text\">userid=[[u]] password=[[p]] address=[[_HOST_ADDRESS]]</asset>\n\t\t\t\t\t<conn_name class=\"w200px\" help=\"Name this connection for reference in the Task.\" input_type=\"text\" label=\"as\" required=\"true\">CONN1</conn_name>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 5,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": "CONN1",
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "",
                    "FunctionName": "cmd_line",
                    "FunctionXML": "<function name=\"cmd_line\" parse_method=\"2\" snip=\"command\" variables=\"true\">\n\t\t\t\t\t<conn_name break_after=\"true\" connection_picker=\"true\" input_type=\"text\" label=\"Connection\" required=\"true\">CONN1</conn_name>\n\t\t\t\t\t<command class=\"w95pct\" input_type=\"textarea\" label=\"Command\" label_style=\"display: block;\" required=\"true\" rows=\"3\">/bin/bash &lt;&lt;EOF\nif [ -f /etc/debian_version ];\nthen\n echo \"nameserver 8.8.8.8\" | sudo tee -a /etc/resolv.conf\n echo \"nameserver 8.8.4.4\" | sudo tee -a /etc/resolv.conf\n sudo apt-get -q update\n sudo apt-get -y -q install curl\nelse\n sudo yum -y --quiet install curl\nfi\ncurl -L https://www.opscode.com/chef/install.sh | sudo bash\nEOF</command>\n\t\t\t\t\t<timeout break_after=\"true\" input_type=\"text\" label=\"Timeout\" option_tab=\"Options\">600</timeout>\n\t\t\t\t\t<positive_response break_after=\"true\" input_type=\"text\" label=\"Positive Response\" option_tab=\"Options\" />\n\t\t\t\t\t<negative_response break_after=\"true\" input_type=\"text\" label=\"Negative Response\" option_tab=\"Options\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 6,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 2,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": "/bin/bash <<EOF\nif [ -f /etc/debian_version ];\nthen\n echo \"nameserver 8.8.8",
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "",
                    "FunctionName": "cmd_line",
                    "FunctionXML": "<function name=\"cmd_line\" parse_method=\"2\" snip=\"command\" variables=\"true\">\n\t\t\t\t\t<conn_name break_after=\"true\" connection_picker=\"true\" input_type=\"text\" label=\"Connection\" required=\"true\">CONN1</conn_name>\n\t\t\t\t\t<command class=\"w95pct\" input_type=\"textarea\" label=\"Command\" label_style=\"display: block;\" required=\"true\" rows=\"3\">echo \"This is where you would perform any additional configuration for your application\"</command>\n\t\t\t\t\t<timeout break_after=\"true\" input_type=\"text\" label=\"Timeout\" option_tab=\"Options\" />\n\t\t\t\t\t<positive_response break_after=\"true\" input_type=\"text\" label=\"Positive Response\" option_tab=\"Options\" />\n\t\t\t\t\t<negative_response break_after=\"true\" input_type=\"text\" label=\"Negative Response\" option_tab=\"Options\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 7,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 2,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": "echo \"This is where you would perform any additional configuration for your",
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "",
                    "FunctionName": "loop",
                    "FunctionXML": "<function name=\"loop\">\n\t\t\t\t\t<start input_type=\"text\">1</start>\n\t\t\t\t\t<counter input_type=\"text\">n</counter>\n\t\t\t\t\t<test input_type=\"select\">&lt;=</test>\n\t\t\t\t\t<compare_to input_type=\"text\">[[hostname,*]]</compare_to>\n\t\t\t\t\t<increment input_type=\"text\">1</increment>\n\t\t\t\t\t<action><function name=\"cmd_line\" parse_method=\"2\" snip=\"command\" variables=\"true\">\n\t\t\t\t\t<conn_name break_after=\"true\" connection_picker=\"true\" input_type=\"text\" label=\"Connection\" required=\"true\">CONN1</conn_name>\n\t\t\t\t\t<command class=\"w95pct\" input_type=\"textarea\" label=\"Command\" label_style=\"display: block;\" required=\"true\" rows=\"3\">echo \"[[hostname,[[n]]]] - [[hostaddress,[[n]]]] - [[instancename,[[n]]]] - [[instanceindex,[[n]]]] - [[servicename,[[n]]]]\" &gt; /tmp/fakeconfigfile.conf</command>\n\t\t\t\t\t<timeout break_after=\"true\" input_type=\"text\" label=\"Timeout\" option_tab=\"Options\" />\n\t\t\t\t\t<positive_response break_after=\"true\" input_type=\"text\" label=\"Positive Response\" option_tab=\"Options\" />\n\t\t\t\t\t<negative_response break_after=\"true\" input_type=\"text\" label=\"Negative Response\" option_tab=\"Options\" />\n\t\t\t\t</function></action>\n\t\t\t\t\t<max input_type=\"text\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 8,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                }
            ]
        }
    ],
    "ConcurrentInstances": "",
    "Description": "",
    "IsDefaultVersion": true,
    "MaxVersion": 1.0,
    "Name": "vCloud Configure App",
    "NextMajorVersion": "2.000",
    "NextMinorVersion": "1.001",
    "NumberOfApprovedVersions": 0,
    "Parameters": "",
    "QueueDepth": "",
    "Status": "Development",
    "UseConnectorSystem": false,
    "Version": 1.0
}
