{
    "Code": "petclinic 105",
    "Codeblocks": [
        {
            "Name": "MAIN",
            "Steps": [
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "initialize application files",
                    "FunctionName": "http",
                    "FunctionXML": "<function name=\"http\" parse_method=\"2\" snip=\"url\" variables=\"true\">\n\t\t\t\t\t<type dataset=\"GET|POST|DELETE|PUT|HEADER\" datasource=\"local\" input_type=\"dropdown\" label=\"Request Type\">GET</type>\n\t\t\t\t\t<url class=\"w95pct\" input_type=\"textarea\" label=\"URL\" label_style=\"display: block;\" required=\"true\" rows=\"1\">http://[[_HOST_ADDRESS]]:8080</url>\n\t\t\t\t\t<data class=\"w95pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\" />\n\t\t\t\t\t<headers is_array=\"true\" label=\"Header Fields\">\n\t\t\t\t\t\t<pair label=\"Key and Values\">\n\t\t\t\t\t\t\t<key input_type=\"text\" label=\"Name\" />\n\t\t\t\t\t\t\t<value class=\"w50pct\" input_type=\"text\" label=\"Value\" />\n\t\t\t\t\t\t</pair>\n\t\t\t\t\t</headers>\n\t\t\t\t\t<timeout break_after=\"true\" input_type=\"text\" label=\"Timeout\" option_tab=\"Options\">10</timeout>\n\t\t\t\t\t<retries break_after=\"true\" input_type=\"text\" label=\"Retries\" option_tab=\"Options\">1</retries>\n\t\t\t\t\t<status_code break_after=\"true\" input_type=\"text\" label=\"Status Code Variable\" option_tab=\"Options\" />\n\t\t\t\t\t<status_msg break_after=\"true\" input_type=\"text\" label=\"Status Message Variable\" option_tab=\"Options\" />\n\t\t\t\t\t<response_header break_after=\"true\" input_type=\"text\" label=\"Response Header Variable\" option_tab=\"Options\" />\n\t\t\t\t\t<response_body break_after=\"true\" input_type=\"text\" label=\"Response Body Variable \" option_tab=\"Options\" />\n\t\t\t\t\t<response_time_ms break_after=\"true\" input_type=\"text\" label=\"Response Time ms Variable\" option_tab=\"Options\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 1,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 2,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": "http://[[_HOST_ADDRESS]]:8080",
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "initialize application files",
                    "FunctionName": "http",
                    "FunctionXML": "<function name=\"http\" parse_method=\"2\" snip=\"url\" variables=\"true\">\n\t\t\t\t\t<type dataset=\"GET|POST|DELETE|PUT|HEADER\" datasource=\"local\" input_type=\"dropdown\" label=\"Request Type\">GET</type>\n\t\t\t\t\t<url class=\"w95pct\" input_type=\"textarea\" label=\"URL\" label_style=\"display: block;\" required=\"true\" rows=\"1\">http://[[_HOST_ADDRESS]]:8080/petclinic</url>\n\t\t\t\t\t<data class=\"w95pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\" />\n\t\t\t\t\t<headers is_array=\"true\" label=\"Header Fields\">\n\t\t\t\t\t\t<pair label=\"Key and Values\">\n\t\t\t\t\t\t\t<key input_type=\"text\" label=\"Name\" />\n\t\t\t\t\t\t\t<value class=\"w50pct\" input_type=\"text\" label=\"Value\" />\n\t\t\t\t\t\t</pair>\n\t\t\t\t\t</headers>\n\t\t\t\t\t<timeout break_after=\"true\" input_type=\"text\" label=\"Timeout\" option_tab=\"Options\">10</timeout>\n\t\t\t\t\t<retries break_after=\"true\" input_type=\"text\" label=\"Retries\" option_tab=\"Options\">1</retries>\n\t\t\t\t\t<status_code break_after=\"true\" input_type=\"text\" label=\"Status Code Variable\" option_tab=\"Options\" />\n\t\t\t\t\t<status_msg break_after=\"true\" input_type=\"text\" label=\"Status Message Variable\" option_tab=\"Options\" />\n\t\t\t\t\t<response_header break_after=\"true\" input_type=\"text\" label=\"Response Header Variable\" option_tab=\"Options\" />\n\t\t\t\t\t<response_body break_after=\"true\" input_type=\"text\" label=\"Response Body Variable \" option_tab=\"Options\" />\n\t\t\t\t\t<response_time_ms break_after=\"true\" input_type=\"text\" label=\"Response Time ms Variable\" option_tab=\"Options\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 2,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 2,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": "http://[[_HOST_ADDRESS]]:8080/petclinic",
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "initialize application files",
                    "FunctionName": "http",
                    "FunctionXML": "<function name=\"http\" parse_method=\"2\" snip=\"url\" variables=\"true\">\n\t\t\t\t\t<type dataset=\"GET|POST|DELETE|PUT|HEADER\" datasource=\"local\" input_type=\"dropdown\" label=\"Request Type\">GET</type>\n\t\t\t\t\t<url class=\"w95pct\" input_type=\"textarea\" label=\"URL\" label_style=\"display: block;\" required=\"true\" rows=\"1\">http://[[_HOST_ADDRESS]]:8080/petclinic/owners/find.html</url>\n\t\t\t\t\t<data class=\"w95pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\" />\n\t\t\t\t\t<headers is_array=\"true\" label=\"Header Fields\">\n\t\t\t\t\t\t<pair label=\"Key and Values\">\n\t\t\t\t\t\t\t<key input_type=\"text\" label=\"Name\" />\n\t\t\t\t\t\t\t<value class=\"w50pct\" input_type=\"text\" label=\"Value\" />\n\t\t\t\t\t\t</pair>\n\t\t\t\t\t</headers>\n\t\t\t\t\t<timeout break_after=\"true\" input_type=\"text\" label=\"Timeout\" option_tab=\"Options\">10</timeout>\n\t\t\t\t\t<retries break_after=\"true\" input_type=\"text\" label=\"Retries\" option_tab=\"Options\">1</retries>\n\t\t\t\t\t<status_code break_after=\"true\" input_type=\"text\" label=\"Status Code Variable\" option_tab=\"Options\" />\n\t\t\t\t\t<status_msg break_after=\"true\" input_type=\"text\" label=\"Status Message Variable\" option_tab=\"Options\" />\n\t\t\t\t\t<response_header break_after=\"true\" input_type=\"text\" label=\"Response Header Variable\" option_tab=\"Options\" />\n\t\t\t\t\t<response_body break_after=\"true\" input_type=\"text\" label=\"Response Body Variable \" option_tab=\"Options\" />\n\t\t\t\t\t<response_time_ms break_after=\"true\" input_type=\"text\" label=\"Response Time ms Variable\" option_tab=\"Options\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 3,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 2,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": "http://[[_HOST_ADDRESS]]:8080/petclinic/owners/find.html",
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "initialize application files",
                    "FunctionName": "http",
                    "FunctionXML": "<function name=\"http\" parse_method=\"2\" snip=\"url\" variables=\"true\">\n\t\t\t\t\t<type dataset=\"GET|POST|DELETE|PUT|HEADER\" datasource=\"local\" input_type=\"dropdown\" label=\"Request Type\">GET</type>\n\t\t\t\t\t<url class=\"w95pct\" input_type=\"textarea\" label=\"URL\" label_style=\"display: block;\" required=\"true\" rows=\"1\">http://[[_HOST_ADDRESS]]:8080/petclinic/vets.html</url>\n\t\t\t\t\t<data class=\"w95pct\" input_type=\"textarea\" label=\"Data\" label_style=\"display: block;\" rows=\"3\" />\n\t\t\t\t\t<headers is_array=\"true\" label=\"Header Fields\">\n\t\t\t\t\t\t<pair label=\"Key and Values\">\n\t\t\t\t\t\t\t<key input_type=\"text\" label=\"Name\" />\n\t\t\t\t\t\t\t<value class=\"w50pct\" input_type=\"text\" label=\"Value\" />\n\t\t\t\t\t\t</pair>\n\t\t\t\t\t</headers>\n\t\t\t\t\t<timeout break_after=\"true\" input_type=\"text\" label=\"Timeout\" option_tab=\"Options\">10</timeout>\n\t\t\t\t\t<retries break_after=\"true\" input_type=\"text\" label=\"Retries\" option_tab=\"Options\">1</retries>\n\t\t\t\t\t<status_code break_after=\"true\" input_type=\"text\" label=\"Status Code Variable\" option_tab=\"Options\" />\n\t\t\t\t\t<status_msg break_after=\"true\" input_type=\"text\" label=\"Status Message Variable\" option_tab=\"Options\" />\n\t\t\t\t\t<response_header break_after=\"true\" input_type=\"text\" label=\"Response Header Variable\" option_tab=\"Options\" />\n\t\t\t\t\t<response_body break_after=\"true\" input_type=\"text\" label=\"Response Body Variable \" option_tab=\"Options\" />\n\t\t\t\t\t<response_time_ms break_after=\"true\" input_type=\"text\" label=\"Response Time ms Variable\" option_tab=\"Options\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 4,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 2,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": "http://[[_HOST_ADDRESS]]:8080/petclinic/vets.html",
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "get global settings from deployment datastore",
                    "FunctionName": "get_deployment_value",
                    "FunctionXML": "<function extension=\"maestro.datastore\" name=\"get_deployment_value\">\n\t\t\t\t\t<scope dataset=\"Deployment|Service\" datasource=\"local\" input_type=\"dropdown\" label=\"Scope\">Deployment</scope>\n\t\t\t\t\t<pairs is_array=\"true\" label=\"Key Value Pairs\">\n\t\t\t\t\t\t<pair label=\"Pair\">\n\t\t\t\t\t\t\t<key input_type=\"text\" label=\"Key\">keyname</key>\n\t\t\t\t\t\t\t<variable_name input_type=\"text\" label=\"Variable\" required=\"true\">key</variable_name>\n\t\t\t\t\t\t</pair>\n\t\t\t\t\t<pair label=\"Pair\">\n\t\t\t\t\t\t\t<key input_type=\"text\" label=\"Key\">user</key>\n\t\t\t\t\t\t\t<variable_name input_type=\"text\" label=\"Variable\" required=\"true\">user</variable_name>\n\t\t\t\t\t\t</pair></pairs>\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 5,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "get load balancer address",
                    "FunctionName": "get_service_hosts",
                    "FunctionXML": "<function extension=\"maestro.maestro\" name=\"get_service_hosts\">\n\t\t\t\t\t<service_name input_type=\"text\" label=\"Service Name (input, optional)\">HAProxy</service_name>\n\t\t\t\t\t<index_in input_type=\"text\" label=\"Instance Index (input, optional)\" />\n\t\t\t\t\t<host_name_out input_type=\"text\" label=\"Host Name (output)\">proxy</host_name_out>\n\t\t\t\t\t<address_out input_type=\"text\" label=\"Host Address (output)\">proxyaddress</address_out>\n\t\t\t\t\t<instance_name input_type=\"text\" label=\"Instance Name (output)\" />\n\t\t\t\t\t<instance_index input_type=\"text\" label=\"Instance Index (output)\" />\n\t\t\t\t\t<service_name_out input_type=\"text\" label=\"Service Name (output)\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 6,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": null,
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "ssh to load balancer",
                    "FunctionName": "new_connection",
                    "FunctionXML": "<function name=\"new_connection\" snip=\"conn_name\">\n\t\t\t\t\t<conn_type input_type=\"select\">ssh</conn_type>\n\t\t\t\t\t<cloud_name input_type=\"dropdown\" style=\"combo\" />\n\t\t\t\t\t<asset input_type=\"text\">address=[[proxyaddress]] shared_cred=[[key]] user=[[user]]</asset>\n\t\t\t\t\t<conn_name class=\"w200px\" help=\"Name this connection for reference in the Task.\" input_type=\"text\" label=\"Connection Name\" required=\"true\">CONN1</conn_name>\n\t\t\t\t\t<debug break_after=\"true\" input_type=\"checkbox\" label=\"Debug\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 7,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 0,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": "CONN1",
                    "XPathPrefix": ""
                },
                {
                    "Codeblock": "MAIN",
                    "Commented": false,
                    "Description": "register tomcat server with load balancer",
                    "FunctionName": "cmd_line",
                    "FunctionXML": "<function name=\"cmd_line\" parse_method=\"2\" snip=\"command\" variables=\"true\">\n\t\t\t\t\t<conn_name break_after=\"true\" connection_picker=\"true\" input_type=\"text\" label=\"Connection\" required=\"true\">CONN1</conn_name>\n\t\t\t\t\t<command class=\"w95pct\" input_type=\"textarea\" label=\"Command\" label_style=\"display: block;\" required=\"true\" rows=\"3\">echo \"server [[_HOST_NAME]] [[_HOST_ADDRESS]]:8080 check inter 5000\" | sudo tee -a /etc/haproxy/haproxy.cfg;sudo service haproxy reload\n</command>\n\t\t\t\t\t<timeout break_after=\"true\" input_type=\"text\" label=\"Timeout\" option_tab=\"Options\" />\n\t\t\t\t\t<positive_response break_after=\"true\" input_type=\"text\" label=\"Positive Response\" option_tab=\"Options\" />\n\t\t\t\t\t<negative_response break_after=\"true\" input_type=\"text\" label=\"Negative Response\" option_tab=\"Options\" />\n\t\t\t\t</function>",
                    "IsValid": true,
                    "Locked": false,
                    "Order": 8,
                    "OutputColumnDelimiter": 0,
                    "OutputParseType": 2,
                    "OutputRowDelimiter": 0,
                    "ValueSnip": "echo \"server [[_HOST_NAME]] [[_HOST_ADDRESS]]:8080 check inter 5000\" | sudo",
                    "XPathPrefix": ""
                }
            ]
        }
    ],
    "ConcurrentInstances": "",
    "Description": "register tomcat server with load balancer",
    "IsDefaultVersion": true,
    "MaxVersion": 1.0,
    "Name": "Register Tomcat",
    "NextMajorVersion": "2.000",
    "NextMinorVersion": "1.001",
    "NumberOfApprovedVersions": 0,
    "Parameters": "",
    "QueueDepth": "",
    "Status": "Development",
    "UseConnectorSystem": false,
    "Version": 1.0
}
